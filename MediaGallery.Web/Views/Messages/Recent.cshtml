@model RecentMessagesPageViewModel
@using System.Text.Json
@{
    ViewData["Title"] = "Recent Messages";
    var jsonOptions = new JsonSerializerOptions(JsonSerializerDefaults.Web);
    var feedEndpoint = Url.Action(
        "RecentData",
        new
        {
            pageSize = Model.Query.PageSize,
            channelId = Model.Query.ChannelId,
            userId = Model.Query.UserId,
            mediaOnly = Model.Query.MediaOnly,
            sortOrder = Model.Query.SortOrder
        });
}

<section class="page-header">
    <div>
        <h1>@ViewData["Title"]</h1>
        <p class="lead">Live feed of monitored messenger channels with inline photo and video playback.</p>
    </div>
    <div class="page-header__meta">
        <span class="badge">Page @Model.Feed.Pagination.PageNumber of @((Model.Feed.Pagination.HasNextPage ? "âˆž" : Model.Feed.Pagination.PageNumber.ToString()))</span>
        @if (Model.Query.ChannelId.HasValue)
        {
            <span class="badge badge--subtle">Channel @Model.Query.ChannelId</span>
        }
        @if (Model.Query.UserId.HasValue)
        {
            <span class="badge badge--subtle">User @Model.Query.UserId</span>
        }
    </div>
</section>

<section class="recent-messages" data-feed-endpoint="@feedEndpoint" data-media-root="@Url.Content("~/media/")" data-initial-page="@Model.Query.Page" data-has-more="@Model.Feed.Pagination.HasNextPage.ToString().ToLowerInvariant()">
    <div class="toolbar" role="toolbar" aria-label="Recent message controls">
        <div class="button-group">
            <button class="btn" data-action="toggle-layout" type="button">Toggle layout</button>
            <button class="btn" data-action="start-slideshow" type="button">Start slideshow</button>
        </div>
        <div class="button-group">
            <label class="switch" for="recent-only-media">
                <input id="recent-only-media" type="checkbox" data-filter="onlyMedia" @(Model.Query.MediaOnly ? "checked" : string.Empty) />
                <span>Only show items with media</span>
            </label>
        </div>
    </div>

    <div class="media-gallery-grid" data-gallery data-scroll-target tabindex="0" aria-live="polite"></div>
    <div class="scroll-status" data-scroll-status aria-live="polite"></div>
    <div class="scroll-sentinel" data-scroll-sentinel></div>
</section>

<script type="application/json" id="recent-messages-data">
    @Html.Raw(JsonSerializer.Serialize(Model.Feed.Messages, jsonOptions))
</script>

@section Scripts {
    <script type="module" src="~/js/recentMessages.js" asp-append-version="true"></script>
}
